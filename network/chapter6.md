# 6장 전송 계층 : 신뢰할 수 있는 데이터 전송하기

> OSI 모델 4계층인 전송 계층에 대해서 설명



## LESSON 23 전송 계층의 역할



### 전송 계층의 두 가지 역할

- 그 이전 계층으로도 목적지에 데이터를 보낼 수 있으나 데이터가 손상되거나 유실되는 경우에 대비하여 신뢰할 수 있는 데이터를 전달하기 위해 필요
- 1) **오류를 점검하는 기능**을 통해 오류가 발생하면 데이터를 재전송하도록 요청
- 2) 전송된 데이터의 **목적지가 어떤 애플리케이션인지** 식별하는 기능



### 연결형 통신과 비연결형 통신

- 전송 계층은 **신뢰성/정확성**과 **효율성**으로 구분되는 특징을 갖고 있다.
  - 신뢰성/정확성 : 데이터를 목적지에 문제없이 전달 - **연결형 통신**
  - 효율성 : 데이터를 빠르고 효율적으로 전달 - **비연결형 통신**
- 연결형 통신은 상대편과 확인해 가면서 통신하는 방식
- 비연결형 통신은 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식 - 동영상을 볼 때
- 연결형 통신 프로토콜에는 **TCP**, 비연결형 통신 프로토콜에는 **UDP**



## LESSON 24 TCP의 구조



### TCP

- TCP로 전송할 때 붙이는 헤더를 TCP 헤더, 이 TCP 헤더가 붙은 데이터를 세그먼트라고 한다.
- 데이터를 전송하기 전에 먼저 연결이라는 가상의 독점 통신로를 확보해야 한다.
- TCP 헤더에서 코드 비트에는 연결의 제어 정보가 기록된다.
  - 초깃값은 0, 비트가 활성화되면 1이 된다.
  - URG / ACK / PSH / RST / SYN / FIN으로 구분된다.
  - 연결을 확립하려면 이 중 SYN(연결 요청)과 ACK(확인 응답)가 필요하다.



### 3-way 핸드셰이크

- 신뢰할 수 있는 연결을 위해 데이터를 전송하기 전 패킷을 교환한다.
  - 1) 컴퓨터 2에 통신을 위한 허가를 받아야 하므로, 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.
  - 2) 컴퓨터 2는 컴퓨터 1이 보낸 요청을 받은 후에 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK)을 보낸다.  컴퓨터2도 컴퓨터 1에게 데이터 전송 허가를 받기 위해 연결 확립 요청(SYN)을 보낸다.
  - 3) 컴퓨터 2의 요청을 받은 컴퓨터 1은 컴퓨터 2로 허가한다는 응답으로 연결 확립 응답(ACK)을 보낸다.
- 이처럼 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것을 3-way 핸드셰이크라고 한다.
- 데이터 전송 후에는 연결을 끊기 위한 요청을 교환한다.
  - 1) 컴퓨터 1에서 컴퓨터 2로 연결 종료 요청(FIN)을 보낸다.
  - 2) 컴퓨터 2에서 컴퓨터 1로 연결 종료 응답(ACK)을 반환한다.
  - 3) 또한 컴퓨터 2에서도 컴퓨터 1로 연결 종료 요청(FIN)을 보낸다.
  - 4) 컴퓨터 1에서 컴퓨터 2로 연결 종료 응답(ACK)을 반환한다.



## LESSON 25 일련번호와 확인 응답 번호의 구조



### 일련번호와 확인 응답 번호

- 3-way 핸드셰이크가 끝나고 실제 데이터를 보내거나 상대방이 받을 때는 TCP 헤더의 일련번호와 확인 응답 번호를 사용한다.
- TCP는 데이터를 분할해서 보내는데 일련번호는 송신 측에서 수신 측에 '이 데이터가 몇 번째 데이터인지' 알려 주는 역할을 한다.
- 확인 응답 번호는 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려 주는 역할을 한다.
  - 다음 번호의 데이터를 요청하는 데도 사용 
- 데이터가 손상되거나 유실된 경우를 대비하여 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우 데이터를 재전송하게 되어 있는데 이르 재전송 제어라고 한다.



### 윈도우 크기

- 위와 같은 방식은 세그먼트(데이터) 하나를 보낼 때마다 확인 응답을 한 번 반환하는 통신 - 효율이 높지 않다
- 하지만 매번 확인 응답을 기다리는 대신 세그먼트를 연속해서 보내고 난 다음에 확인 응답을 반환하면 효율이 높아진다.
- 상대방에 세그먼트가 쌓이는 것을 방지하기 위해 세그먼트를 일시적으로 보관하는 버퍼라는 장소가 있다.
- 수신 측이 대량으로 테이터를 전송받아 보관하지 못하고 넘쳐 흐르는 경우가 있는데 이것을 오버플로라고 한다.
- 오버플로를 예방하기 위해 버퍼의 한계 크기를 알아야 하는데 TCP 헤더의 윈도우 크기 값이 이에 해당한다.
- 얼마나 많은 용량의 데이터를 저장해 둘 수 있는지!
- 3-way 핸드셰이크를 할 때 판단



## LESSON 26 포트 번호의 구조



### 포트 번호

- TCP 헤더의 출발지 포트 번호와 목적지 포트 번호를 통해 애플리케이션을 구분 가능
- 0~1023 포트는 주요 프로토콜이 사용하도록 예약(well-known ports)
- 1024번은 예약되어 있지만 사용되지는 않는 포트
- 1025번 이상은 랜덤 포트라고 불리는데 클라이언트측의 송신 포트로 사용



## LESSON 27 UDP의 구조



### UDP

- TCP와 달리 데이터를 전송할 때 TCP처럼 확인 작업을 일일이 하지 않는다.
- 장점은 데이터를 효율적으로 빠르게 보내는 것으로 스트리밍 방식으로 전송하는 동영상 서비스에서 사용된다.



### UDP 헤더란?

- UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 한다.
  - 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬
- 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보내는 브로드캐스트가 가능하다.
- TCP는 확인 응답을 하나씩 보내야 하기 때문에 불특정 다수에게 보내는 일괄 통신에는 적합하지 않다.