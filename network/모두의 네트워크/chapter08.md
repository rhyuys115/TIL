# 8장 네트워크의 전체 흐름 살펴보기



## LESSON 32 랜 카드에서의 데이터 전달과 처리

### 네트워크 구성

|               계층               | 기능                                         |
| :------------------------------: | -------------------------------------------- |
| 응용 계층(세션 계층과 표현 계층) | 애플리케이션 등에서 사용하는 데이터를 송수신 |
|            전송 계층             | 목적지에 데이터를 정확하게 전달              |
|          네트워크 계층           | 다른 네트워크에 있는 목적지에 데이터를 전달  |
|         데이터 링크 계층         | 랜에서 데이터를 송수신                       |
|            물리 계층             | 데이터를 전기신호로 변환                     |

- 컴퓨터A - 스위치A-라우터A-라우터B-스위치B-웹서버로 구성된 네트워크가 있을 때 3개의 네트워크로 나눌 수 있다.

### 컴퓨터의 데이터가 전기 신호로 변환되는 과정

컴퓨터의 웹 브라우저에 URL을 입력할 때부터 웹 서버에 도착할 때까지 이루어지는 OSI 모델의 캡슐화 역캡슐화를 생각해보자.

- 컴퓨터에서 OSI 모델의 캡슐화가 이루어진다.
- 응용계층에서 시작 - 웹 브라우저에 URL을 입력하고 `Enter`키를 누르면 캡슐화가 시작된다.(3-way 핸드셰이크가 완료되어 연결이 확립되어 있다고 가정)
- HTTP 프로토콜을 사용하여 응용계층에서 웹 서버에 있는 html 데이터를 얻기 위한 HTTP 메시지를 보낸다.
- 이 데이터는 전송 꼐층에 전달되어 TCP 헤더가 붙는다( 데이터 => 세그먼트)
  - 어느 애플리케이션에 데이터를 보낼 지  식별하는 출발지 포트 번화와 목적지 포트 번호
  - 출발지 포트 번호는 1025번 이상인 포트에서 무작위로 선택
  - 목적지 포트 번호는 이 경우 HTTP이므로 80번 포트
- 세그먼트는 네트워크 계층에 전달되어 IP 헤더가 붙는다( 세그먼트 => IP 패킷)
  - 출발지 IP 주소, 목적지 IP 주소
- IP 패킷은 데이터 링크 계층으로 전달되어 이더넷 헤더가 붙는다( IP 패킷 => 이더넷 프레임)
- 이더넷 프레임은 물리계층으로 전달되어 랜을 사용, 전기 신호로 변환되어 네트워크로 전송된다.

## LESSON 33 스위치와 라우터에서의 데이터 전달과 처리

### 스위치 A, 라우터 A

- 스위치 A는 데이터 링크 계층에서 데이터를 전기 신호로 변환하여 라우터 A로 전송
- 변환된 전기신호가 케이블을 통해 흘러가 라우터 A에 도착하면 라우터 A는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교한다.
- 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역 캡슐화를 수행한다.
- 네트워크 계층에 전달하고 자신의 라우팅 테이블과 목적지 IP 주소를 비교한다.
- 라우터 A의 라우팅 테이블에서 목적지 IP 주소의 경로를 알 수 있으므로 라우팅이 가능하다.
- 현재 출발지 IP 주소를 라우터의 외부 IP 주소로 변경한다.
- 이후 데이터는 데이터 링크 계층으로 전달되어 라우터 B로 보내지도록 이더넷 헤더와 트레일러를 붙인 후에 물리 계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달
- 데이터는 전기 신호 형태로 라우터 A에서 라우터 B로 전달

### 스위치 B, 라우터 B

- 전기 신호로 변환된 데이터가 케이블을 통해 라우터 B로 도착하면 라우터 B는 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교
- 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행
- 네트워크 계층으로 전달되면 자신의 라우팅 테이블과 목적지 IP 주소를 비교
  - 라우터 B도 라우터 A와 마찬가지로 목적지의 네트워크를 알아야 하기 때문
- 라우팅 테이블을 확인해 현재의 출발지 IP 주소를 라우터 B의 내부 IP 주소로 변경한다.
- 데이터 링크 계층에 전달하여 스위치에 전달되도록 이더넷 헤더와 트레일러를 붙인 후 물리 계층에서 데이터를 전기신호로 변환, 네트워크로 전달한다.
- 전달받은 스위치 B는 전기 신호를 데이터 링크 계층에서 처리하고 웹 서버에 데이터를 전기 신호로 전달



## LESSON 34 웹 서버에서의 데이터 전달과 처리

- 데이터가 전기 신호로 웹 서버에 도착하면 웹 서버는 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소를 비교, 같으면 이더넷 헤더와 트레일러를 분리해 네트워크 계층에 전달
- 네트워크 계층에서는 목적지 IP 주소와 웹 서버의 IP 주소가 같은지 확인, 같으면 IP 헤더를 분리, 전송 계층에 전달
- 전송 계층에서는 목적지 포트 번호를 확인하여 어떤 애플리케이션으로 전달해야되는지 판단하고 TCP, 헤더를 분리하여 응용 계층에 전달



## 정적 라우팅과 동적 라우팅

### 정적 라우팅

- 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가하는 방법
  - 목적지까지의 경로를 고정하거나 목적지까지의 경로가 하나로 한정되는 경우에 사용
  - 네트워크에 존재하는 모든 목적지 네트워크의 정보를 라우터에 알려 줘야 한다 => 소규모 네트워크에서 사용
  - 라우팅 정보가 교환되지 않아 대역폭에 부담이 적음
  - 라우팅 정보가 네트워크로 전달되지 않으므로 보안을 유지하기 좋음
  - 경로에 장애가 발생해도 다른 경로로 우회할 수 없어 관리자가 설정을 하나하나 변경해야 하는 단점

### 동적 라우팅

- 네트워크 변경을 자동으로 감지하여 라우팅 테이블을 업데이트하거나 네트워크 장애가 발생했을 때 라우터끼리 정보를 교환하여 최적의 경로로 전환하는 기능
- 대규모 네트워크에서 라우터에 많은 경로가 등록되어 정적 라우팅을 지원하지 않고 동적 라우팅을 사용하여 경로를 자동으로 업데이트